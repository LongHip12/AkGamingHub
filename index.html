<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Traffic Counter</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #fca311;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(120deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            font-size: 1rem;
            color: var(--gray);
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-card.today .value {
            color: var(--success);
        }
        
        .stat-card.online .value {
            color: var(--warning);
        }
        
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .chart-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .last-updated {
            text-align: right;
            margin-top: 20px;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Real-Time Traffic Monitor</h1>
            <p>Theo dõi lưu lượng truy cập trang web theo thời gian thực</p>
        </header>
        
        <div class="stats-container">
            <div class="stat-card">
                <h3>Tổng số truy cập</h3>
                <div class="value" id="total-visits">0</div>
            </div>
            <div class="stat-card today">
                <h3>Hôm nay</h3>
                <div class="value" id="today-visits">0</div>
            </div>
            <div class="stat-card online">
                <h3>Đang truy cập</h3>
                <div class="value" id="online-now">0</div>
            </div>
        </div>
        
        <div class="chart-container">
            <h2 class="chart-title">Lưu lượng truy cập 24 giờ qua</h2>
            <canvas id="trafficChart"></canvas>
        </div>
        
        <h2 class="chart-title">Chi tiết truy cập</h2>
        <table>
            <thead>
                <tr>
                    <th>Thời gian</th>
                    <th>Địa chỉ IP</th>
                    <th>Trình duyệt</th>
                    <th>Trang đã truy cập</th>
                </tr>
            </thead>
            <tbody id="visits-table">
                <!-- Dữ liệu sẽ được thêm bằng JavaScript -->
            </tbody>
        </table>
        
        <div class="last-updated" id="last-updated">
            Cập nhật lúc: <span id="update-time">--:--:--</span>
        </div>
    </div>

    <script>
        // Khởi tạo dữ liệu mẫu
        function initData() {
            if (!localStorage.getItem('trafficData')) {
                const trafficData = {
                    totalVisits: 12568,
                    todayVisits: 243,
                    onlineNow: 12,
                    visits: []
                };
                
                // Tạo dữ liệu mẫu cho 24 giờ qua
                const now = new Date();
                for (let i = 23; i >= 0; i--) {
                    const time = new Date(now);
                    time.setHours(now.getHours() - i);
                    time.setMinutes(0);
                    time.setSeconds(0);
                    time.setMilliseconds(0);
                    
                    trafficData.visits.push({
                        timestamp: time.getTime(),
                        count: Math.floor(Math.random() * 50) + 10,
                        details: []
                    });
                }
                
                // Thêm một số dữ liệu truy cập mẫu
                const sampleIPs = ['192.168.1.1', '123.45.67.89', '172.16.254.1', '103.21.244.0'];
                const sampleBrowsers = ['Chrome', 'Firefox', 'Safari', 'Edge'];
                const samplePages = ['/', '/products', '/about', '/contact', '/blog'];
                
                for (let i = 0; i < 20; i++) {
                    const visitTime = new Date(now.getTime() - Math.random() * 24 * 60 * 60 * 1000);
                    trafficData.visits[23].details.push({
                        timestamp: visitTime.getTime(),
                        ip: sampleIPs[Math.floor(Math.random() * sampleIPs.length)],
                        browser: sampleBrowsers[Math.floor(Math.random() * sampleBrowsers.length)],
                        page: samplePages[Math.floor(Math.random() * sampleBrowsers.length)]
                    });
                }
                
                localStorage.setItem('trafficData', JSON.stringify(trafficData));
            }
            
            // Mô phỏng người dùng mới truy cập
            simulateNewVisit();
        }
        
        // Mô phỏng lượt truy cập mới
        function simulateNewVisit() {
            setInterval(() => {
                const trafficData = JSON.parse(localStorage.getItem('trafficData'));
                const now = new Date();
                
                // Tăng số lượt truy cập
                trafficData.totalVisits++;
                trafficData.todayVisits++;
                
                // Cập nhật số người online (ngẫu nhiên từ 8-15)
                trafficData.onlineNow = Math.floor(Math.random() * 8) + 8;
                
                // Thêm vào dữ liệu giờ hiện tại
                const currentHour = new Date(now);
                currentHour.setMinutes(0);
                currentHour.setSeconds(0);
                currentHour.setMilliseconds(0);
                
                const hourIndex = trafficData.visits.findIndex(visit => {
                    return visit.timestamp === currentHour.getTime();
                });
                
                if (hourIndex !== -1) {
                    trafficData.visits[hourIndex].count++;
                    
                    // Thêm chi tiết truy cập
                    const sampleIPs = ['192.168.1.' + Math.floor(Math.random() * 255), 
                                      '123.45.67.' + Math.floor(Math.random() * 255)];
                    const sampleBrowsers = ['Chrome', 'Firefox', 'Safari', 'Edge'];
                    const samplePages = ['/', '/products', '/about', '/contact', '/blog'];
                    
                    trafficData.visits[hourIndex].details.push({
                        timestamp: now.getTime(),
                        ip: sampleIPs[Math.floor(Math.random() * sampleIPs.length)],
                        browser: sampleBrowsers[Math.floor(Math.random() * sampleBrowsers.length)],
                        page: samplePages[Math.floor(Math.random() * sampleBrowsers.length)]
                    });
                } else {
                    // Tạo mới nếu chưa có giờ này
                    trafficData.visits.shift(); // Xóa giờ cũ nhất
                    trafficData.visits.push({
                        timestamp: currentHour.getTime(),
                        count: 1,
                        details: [{
                            timestamp: now.getTime(),
                            ip: '192.168.1.' + Math.floor(Math.random() * 255),
                            browser: 'Chrome',
                            page: '/'
                        }]
                    });
                }
                
                localStorage.setItem('trafficData', JSON.stringify(trafficData));
                
                // Cập nhật giao diện
                updateDisplay();
            }, 3000); // Cập nhật mỗi 3 giây
        }
        
        // Cập nhật hiển thị
        function updateDisplay() {
            const trafficData = JSON.parse(localStorage.getItem('trafficData'));
            
            // Cập nhật các thống kê
            document.getElementById('total-visits').textContent = trafficData.totalVisits.toLocaleString();
            document.getElementById('today-visits').textContent = trafficData.todayVisits.toLocaleString();
            document.getElementById('online-now').textContent = trafficData.onlineNow.toLocaleString();
            
            // Cập nhật biểu đồ
            updateChart(trafficData);
            
            // Cập nhật bảng
            updateTable(trafficData);
            
            // Cập nhật thời gian
            const now = new Date();
            document.getElementById('update-time').textContent = now.toLocaleTimeString();
        }
        
        // Cập nhật biểu đồ
        function updateChart(trafficData) {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            
            // Chuẩn bị dữ liệu cho biểu đồ
            const labels = trafficData.visits.map(visit => {
                const date = new Date(visit.timestamp);
                return date.getHours() + ':00';
            });
            
            const data = trafficData.visits.map(visit => visit.count);
            
            // Tạo hoặc cập nhật biểu đồ
            if (window.trafficChartInstance) {
                window.trafficChartInstance.data.labels = labels;
                window.trafficChartInstance.data.datasets[0].data = data;
                window.trafficChartInstance.update();
            } else {
                window.trafficChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Lượt truy cập',
                            data: data,
                            backgroundColor: 'rgba(67, 97, 238, 0.2)',
                            borderColor: 'rgba(67, 97, 238, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            pointRadius: 4,
                            pointBackgroundColor: 'rgba(67, 97, 238, 1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // Cập nhật bảng dữ liệu
        function updateTable(trafficData) {
            const tableBody = document.getElementById('visits-table');
            tableBody.innerHTML = '';
            
            // Lấy tất cả chi tiết truy cập và sắp xếp theo thời gian mới nhất
            let allDetails = [];
            trafficData.visits.forEach(visit => {
                allDetails = allDetails.concat(visit.details);
            });
            
            allDetails.sort((a, b) => b.timestamp - a.timestamp);
            
            // Hiển thị 10 bản ghi mới nhất
            const recentDetails = allDetails.slice(0, 10);
            
            recentDetails.forEach(detail => {
                const row = document.createElement('tr');
                
                const timeCell = document.createElement('td');
                timeCell.textContent = new Date(detail.timestamp).toLocaleString();
                
                const ipCell = document.createElement('td');
                ipCell.textContent = detail.ip;
                
                const browserCell = document.createElement('td');
                browserCell.textContent = detail.browser;
                
                const pageCell = document.createElement('td');
                pageCell.textContent = detail.page;
                
                row.appendChild(timeCell);
                row.appendChild(ipCell);
                row.appendChild(browserCell);
                row.appendChild(pageCell);
                
                tableBody.appendChild(row);
            });
        }
        
        // Khởi tạo ứng dụng
        document.addEventListener('DOMContentLoaded', () => {
            initData();
            updateDisplay();
            
            // Cập nhật mỗi phút để đồng hồ chạy
            setInterval(() => {
                const now = new Date();
                document.getElementById('update-time').textContent = now.toLocaleTimeString();
            }, 1000);
        });
    </script>
</body>
</html>